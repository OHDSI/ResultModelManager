<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Result Set Export Manager — ResultExportManager • ResultModelManager</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Result Set Export Manager — ResultExportManager"><meta name="description" content="EXPERIMENTAL - this feature is still in design stage and it is not reccomended that you implement this for your
package at this stage.
Utility for simplifying export of results to files from sql queries
Note that this utility is not strictly thread safe though seperate processes can export separate tables
without issue. When exporting a the same table across multiple threads primary key checks may create
issues."><meta property="og:description" content="EXPERIMENTAL - this feature is still in design stage and it is not reccomended that you implement this for your
package at this stage.
Utility for simplifying export of results to files from sql queries
Note that this utility is not strictly thread safe though seperate processes can export separate tables
without issue. When exporting a the same table across multiple threads primary key checks may create
issues."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ResultModelManager</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CreatingMigrations.html">Creating Migrations</a></li>
    <li><a class="dropdown-item" href="../articles/ExampleProject.html">Example package results spec</a></li>
    <li><a class="dropdown-item" href="../articles/PackageDesign.html">Package Design</a></li>
    <li><a class="dropdown-item" href="../articles/UploadFunctionality.html">Upload Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/UsingAnExportManager.html">Using An Export Manager</a></li>
    <li><a class="dropdown-item" href="../articles/UsingConnectionHandlers.html">Using Connection Handlers</a></li>
    <li><a class="dropdown-item" href="../articles/UsingPythonUploads.html">Using python for postrgresql uploads</a></li>
    <li><a class="dropdown-item" href="../articles/UsingQueryNamespaces.html">Using Query Namespaces</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/ResultModelManager"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/ResultModelManager/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Result Set Export Manager</h1>
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/ResultModelManager/blob/HEAD/R/ResultExportManager.R" class="external-link"><code>R/ResultExportManager.R</code></a></small>
      <div class="d-none name"><code>ResultExportManager.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>EXPERIMENTAL - this feature is still in design stage and it is not reccomended that you implement this for your
package at this stage.
Utility for simplifying export of results to files from sql queries</p>
<p>Note that this utility is not strictly thread safe though seperate processes can export separate tables
without issue. When exporting a the same table across multiple threads primary key checks may create
issues.</p>
    </div>


    <div class="section level2">
    <h2 id="public-fields">Public fields<a class="anchor" aria-label="anchor" href="#public-fields"></a></h2>
    <p></p><div class="r6-fields"><dl><dt><code>exportDir</code></dt>
<dd><p>direcotry path to export files to
Init</p></dd>


</dl><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-ResultExportManager-new"><code>ResultExportManager$new()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-getTableSpec"><code>ResultExportManager$getTableSpec()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-getMinColValues"><code>ResultExportManager$getMinColValues()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-checkRowTypes"><code>ResultExportManager$checkRowTypes()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-listTables"><code>ResultExportManager$listTables()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-checkPrimaryKeys"><code>ResultExportManager$checkPrimaryKeys()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-exportDataFrame"><code>ResultExportManager$exportDataFrame()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-exportQuery"><code>ResultExportManager$exportQuery()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-getManifestList"><code>ResultExportManager$getManifestList()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-writeManifest"><code>ResultExportManager$writeManifest()</code></a></p></li>
<li><p><a href="#method-ResultExportManager-clone"><code>ResultExportManager$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-ResultExportManager-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Create a class for exporting results from a study in a standard, consistend manner</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/ResultExportManager.html">ResultExportManager</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">tableSpecification</span>,</span>
<span>  <span class="va">exportDir</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"ohdsi.minCellCount"</span>, default <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  validateTypes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  usePrimaryKeyCheck <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  databaseId <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>tableSpecification</code></dt>
<dd><p>Table specification data.frame</p></dd>


<dt><code>exportDir</code></dt>
<dd><p>Directory files are being exported to</p></dd>


<dt><code>minCellCount</code></dt>
<dd><p>Minimum cell count - reccomended that you set with
options("ohdsi.minCellCount" = count) in all R projects. Default is 5</p></dd>


<dt><code>validateTypes</code></dt>
<dd><p>Test if row values strictly conform to types - optional, not currently reccomended
outside of development</p></dd>


<dt><code>usePrimaryKeyCheck</code></dt>
<dd><p>Test if primary key fields are violated at export step. - optional, not currently reccomended
outside of development
get table spec</p></dd>


<dt><code>databaseId</code></dt>
<dd><p>database identifier - required when exporting according to many specs</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-getTableSpec"></a><div class="section">
<h3 id="method-gettablespec-">Method <code>getTableSpec()</code><a class="anchor" aria-label="anchor" href="#method-gettablespec-"></a></h3>
<p>Get specification of table</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">getTableSpec</span><span class="op">(</span><span class="va">exportTableName</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>exportTableName</code></dt>
<dd><p>table name
Get min col values</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-getMinColValues"></a><div class="section">
<h3 id="method-getmincolvalues-">Method <code>getMinColValues()</code><a class="anchor" aria-label="anchor" href="#method-getmincolvalues-"></a></h3>
<p>Columns to convert to minimum for a given table name</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">getMinColValues</span><span class="op">(</span><span class="va">rows</span>, <span class="va">exportTableName</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>rows</code></dt>
<dd><p>data.frame of rows</p></dd>


<dt><code>exportTableName</code></dt>
<dd><p>stering table name - must be defined in spec
Check row types</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-checkRowTypes"></a><div class="section">
<h3 id="method-checkrowtypes-">Method <code>checkRowTypes()</code><a class="anchor" aria-label="anchor" href="#method-checkrowtypes-"></a></h3>
<p>Check types of rows before exporting</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">checkRowTypes</span><span class="op">(</span><span class="va">rows</span>, <span class="va">exportTableName</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>rows</code></dt>
<dd><p>data.frame of rows to export</p></dd>


<dt><code>exportTableName</code></dt>
<dd><p>table name
List tables</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-listTables"></a><div class="section">
<h3 id="method-listtables-">Method <code>listTables()</code><a class="anchor" aria-label="anchor" href="#method-listtables-"></a></h3>
<p>list all tables in schema
Check primary keys of exported data</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">listTables</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ResultExportManager-checkPrimaryKeys"></a><div class="section">
<h3 id="method-checkprimarykeys-">Method <code>checkPrimaryKeys()</code><a class="anchor" aria-label="anchor" href="#method-checkprimarykeys-"></a></h3>
<p>Checks to see if the rows conform to the valid primary keys
If the same table has already been checked in the life of this object set
"invalidateCache" to TRUE as the keys will be cached in a temporary file
on disk.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">checkPrimaryKeys</span><span class="op">(</span></span>
<span>  <span class="va">rows</span>,</span>
<span>  <span class="va">exportTableName</span>,</span>
<span>  invalidateCache <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>rows</code></dt>
<dd><p>data.frame to export</p></dd>


<dt><code>exportTableName</code></dt>
<dd><p>Table name (must be in spec)</p></dd>


<dt><code>invalidateCache</code></dt>
<dd><p>logical - if starting a fresh export use this to delete cache of primary keys
Export data frame</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-exportDataFrame"></a><div class="section">
<h3 id="method-exportdataframe-">Method <code>exportDataFrame()</code><a class="anchor" aria-label="anchor" href="#method-exportdataframe-"></a></h3>
<p>This method is intended for use where exporting a data.frame and not a query from a rdbms table
For example, if you perform a transformation in R this method will check primary keys, min cell counts and
data types before writing the file to according to the table spec</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">exportDataFrame</span><span class="op">(</span><span class="va">rows</span>, <span class="va">exportTableName</span>, append <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>rows</code></dt>
<dd><p>Rows to export</p></dd>


<dt><code>exportTableName</code></dt>
<dd><p>Table name</p></dd>


<dt><code>append</code></dt>
<dd><p>logical - if true will append the result to a file, otherwise the file will be overwritten
Export Data table with sql query</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-exportQuery"></a><div class="section">
<h3 id="method-exportquery-">Method <code>exportQuery()</code><a class="anchor" aria-label="anchor" href="#method-exportquery-"></a></h3>
<p>Writes files in batch to stop overflowing system memory
Checks primary keys on write
Checks minimum cell count</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">exportQuery</span><span class="op">(</span></span>
<span>  <span class="va">connection</span>,</span>
<span>  <span class="va">sql</span>,</span>
<span>  <span class="va">exportTableName</span>,</span>
<span>  transformFunction <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transformFunctionArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>connection</code></dt>
<dd><p>DatabaseConnector connection instance</p></dd>


<dt><code>sql</code></dt>
<dd><p>OHDSI sql string to export tables</p></dd>


<dt><code>exportTableName</code></dt>
<dd><p>Name of table to export (in snake_case format)</p></dd>


<dt><code>transformFunction</code></dt>
<dd><p>(optional) transformation of the data set callback.
must take two paramters - rows and pos</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>   Following this transformation callback, results will be verified against data model,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>   Primary keys will be checked and minCellValue rules will be enforced</span></code></pre><p></p></div></dd>


<dt><code>transformFunctionArgs</code></dt>
<dd><p>arguments to be passed to the transformation function</p></dd>


<dt><code>append</code></dt>
<dd><p>Logical add results to existing file, if FALSE (default) creates a new file and removes primary
key validation cache</p></dd>


<dt><code>...</code></dt>
<dd><p>extra parameters passed to sql
get manifest list</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-getManifestList"></a><div class="section">
<h3 id="method-getmanifestlist-">Method <code>getManifestList()</code><a class="anchor" aria-label="anchor" href="#method-getmanifestlist-"></a></h3>
<p>Create a meta data set for each collection of result files with sha256 has for all files</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">getManifestList</span><span class="op">(</span></span>
<span>  packageName <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  packageVersion <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  migrationsPath <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  migrationRegexp <span class="op">=</span> <span class="va">.defaultMigrationRegexp</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>packageName</code></dt>
<dd><p>if an R analysis package, specify the name</p></dd>


<dt><code>packageVersion</code></dt>
<dd><p>if an analysis package, specify the version</p></dd>


<dt><code>migrationsPath</code></dt>
<dd><p>path to sql migrations (use top level folder (e.g. sql/sql_server/migrations)</p></dd>


<dt><code>migrationRegexp</code></dt>
<dd><p>(optional) regular expression to search for sql files. It is not reccomended to change the default.
Write manifest</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-writeManifest"></a><div class="section">
<h3 id="method-writemanifest-">Method <code>writeManifest()</code><a class="anchor" aria-label="anchor" href="#method-writemanifest-"></a></h3>
<p>Write manifest json</p><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">writeManifest</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>@seealso getManifestList</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ResultExportManager-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ResultExportManager</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jamie Gilbert.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

