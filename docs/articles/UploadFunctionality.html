<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Upload Functionality â€¢ ResultModelManager</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Upload Functionality">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ResultModelManager</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CreatingMigrations.html">Creating Migrations</a></li>
    <li><a class="dropdown-item" href="../articles/ExampleProject.html">Example package results spec</a></li>
    <li><a class="dropdown-item" href="../articles/PackageDesign.html">Package Design</a></li>
    <li><a class="dropdown-item" href="../articles/UploadFunctionality.html">Upload Functionality</a></li>
    <li><a class="dropdown-item" href="../articles/UsingAnExportManager.html">Using An Export Manager</a></li>
    <li><a class="dropdown-item" href="../articles/UsingConnectionHandlers.html">Using Connection Handlers</a></li>
    <li><a class="dropdown-item" href="../articles/UsingPythonUploads.html">Using python for postrgresql uploads</a></li>
    <li><a class="dropdown-item" href="../articles/UsingQueryNamespaces.html">Using Query Namespaces</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://ohdsi.github.io/ResultModelManager"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/ResultModelManager/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Upload Functionality</h1>
                        <h4 data-toc-skip class="author">James P.
Gilbert</h4>
            
            <h4 data-toc-skip class="date">2025-10-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/ResultModelManager/blob/HEAD/vignettes/UploadFunctionality.Rmd" class="external-link"><code>vignettes/UploadFunctionality.Rmd</code></a></small>
      <div class="d-none name"><code>UploadFunctionality.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes the functionality for uploading results to a
pre-created database schema. In the examples here, we assume the use of
sqlite for simplicity. However, in principle any platform supported by
the <code>DatabaseConnector</code> and <code>SqlRender</code> packages
should work.</p>
</div>
<div class="section level2">
<h2 id="creating-a-schema-definition-file">Creating a schema definition file<a class="anchor" aria-label="anchor" href="#creating-a-schema-definition-file"></a>
</h2>
<p>It is recommended that every analytics package that creates data
output should contain a csv file. This is a requirement for packages
that use the OHDSI <code>Strategus</code> library.</p>
<p>Schema definitions should conform to the following column
headers:</p>
<pre><code>table_name, column_name, data_type, is_required, primary_key</code></pre>
<p>In addition, other packages may make use of additional fields such as
<code>optional</code> or <code>empty_is_na</code>. These are not
required for uploading to a schem.</p>
<p>An example csv file may look like this:</p>
<pre><code># File inst/settings/resulsDataModelSpecifications.csv
table_name,column_name,data_type,is_required,primary_key
table_1,database_id,varchar,Yes,Yes
table_1,analysis_id,bigint,Yes,Yes
table_1,analysis_name,varchar,Yes,No
table_1,domain_id,varchar(20),No,No
table_1,start_day,float,No,No
table_1,end_day,float,No,No
table_1,is_binary,varchar(1),Yes,No
table_1,missing_means_zero,varchar(1),No,No
table_2,database_id,varchar,Yes,Yes
table_2,analysis2_id,bigint,Yes,Yes
table_2,concept_id,int,Yes,No
table_2,logic_description,varchar,No,No
table_2,valid_start_date,Date,Yes,No
table_2,concept_name,varchar(255),Yes,No
table_2,p_10_value,float,Yes,No
table_3,database_id,varchar,Yes,Yes
table_3,analysis3_id,bigint,Yes,Yes
table_3,concept_id,int,Yes,No
table_3,logic_description,varchar,No,No
table_3,valid_start_date,Date,Yes,No
table_3,concept_name,varchar(255),Yes,No
table_3,p_10_value,float,Yes,No</code></pre>
<p>Note the use of sql server data types in the <code>data_type</code>
field as well as <code>yes</code> and <code>no</code> in the binary
field <code>is_required</code> and <code>primary_key</code>.</p>
<p>We should also define a function for loading this file that converts
the column headers to camel case format.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Get Results Data Model Specifcations</span></span>
<span><span class="va">getResultsDataModelSpec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># For loading inside an R package</span></span>
<span>  <span class="va">specPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"settings"</span>, <span class="st">"resulsDataModelSpecifications.csv"</span>, package <span class="op">=</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageName.html" class="external-link">packageName</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">specPath</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SqlRender</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/SqlRender/reference/snakeCaseToCamelCase.html" class="external-link">snakeCaseToCamelCase</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-schema">Creating a schema<a class="anchor" aria-label="anchor" href="#creating-a-schema"></a>
</h2>
<p>This section describes how to use <code>RMM</code> to create a schema
from a specifications file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span><span class="st">"sqlite"</span>, server <span class="op">=</span> <span class="st">"MySqliteDb.sqlite"</span><span class="op">)</span></span>
<span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu">ResultModelManager</span><span class="fu">::</span><span class="fu"><a href="../reference/generateSqlSchema.html">generateSqlSchema</a></span><span class="op">(</span>schemaDefinition <span class="op">=</span> <span class="fu">getResultsDataModelSpec</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateExecuteSql.html" class="external-link">renderTranslateExecuteSql</a></span><span class="op">(</span><span class="va">connection</span>, <span class="va">sql</span>, database_schema <span class="op">=</span> <span class="st">"main"</span>, table_prefix <span class="op">=</span> <span class="st">"pre_"</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/disconnect.html" class="external-link">disconnect</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span></code></pre></div>
<p>Note that the SQL generated by <code>generateSqlSchema</code>
contains the required parameter <code>database_schema</code> and the
optional parameter <code>table_prefix</code>.</p>
</div>
<div class="section level2">
<h2 id="uploading-results">Uploading results<a class="anchor" aria-label="anchor" href="#uploading-results"></a>
</h2>
<p>This section shows how to upload results conforming to the above
specified schema. It is assumed that a zip file has been created with
csv files corresponding to the table names provided in the
<code>resulsDataModelSpecifications.csv</code> file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ResultModelManager</span><span class="fu">::</span><span class="fu"><a href="../reference/unzipResults.html">unzipResults</a></span><span class="op">(</span>zipFile <span class="op">=</span> <span class="st">"MyResultsZip.zip"</span>, resultsFolder <span class="op">=</span> <span class="st">"extraction_folder"</span><span class="op">)</span></span>
<span><span class="fu">ResultModelManager</span><span class="fu">::</span><span class="fu"><a href="../reference/uploadResults.html">uploadResults</a></span><span class="op">(</span><span class="va">connectionDetails</span>,</span>
<span>  schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  resultsFolder <span class="op">=</span> <span class="st">"extraction_folder"</span>,</span>
<span>  tablePrefix <span class="op">=</span> <span class="st">"pre_"</span>,</span>
<span>  purgeSiteDataBeforeUploading <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  specifications <span class="op">=</span> <span class="fu">getResultsDataModelSpec</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will extract the zip file and upload results using
<code>DatabaseConnector</code>. For most platforms some form of bulk
loading is supported, the setup for this is contained in the
documentation for <code>DatabaseConnector</code>, it is strongly advised
that you set up and use this functionality for any platforms where you
will store large data sets. However, this is not necessary for the
sqlite example demonstrated here.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jamie Gilbert.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
