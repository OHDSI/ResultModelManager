<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Functionality â€¢ ResultModelManager</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Upload Functionality">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ResultModelManager</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CreatingMigrations.html">Creating Migrations</a>
    </li>
    <li>
      <a href="../articles/ExampleProject.html">Example package results spec</a>
    </li>
    <li>
      <a href="../articles/PackageDesign.html">Package Design</a>
    </li>
    <li>
      <a href="../articles/UploadFunctionality.html">Upload Functionality</a>
    </li>
    <li>
      <a href="../articles/UsingAnExportManager.html">Using An Export Manager</a>
    </li>
    <li>
      <a href="../articles/UsingConnectionHandlers.html">Using Connection Handlers</a>
    </li>
    <li>
      <a href="../articles/UsingQueryNamespaces.html">Using Query Namespaces</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/ResultModelManager" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/ResultModelManager/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Upload Functionality</h1>
                        <h4 data-toc-skip class="author">James P.
Gilbert</h4>
            
            <h4 data-toc-skip class="date">2024-08-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/ResultModelManager/blob/HEAD/vignettes/UploadFunctionality.Rmd" class="external-link"><code>vignettes/UploadFunctionality.Rmd</code></a></small>
      <div class="hidden name"><code>UploadFunctionality.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes the functionality for uploading results to a
pre-created database schema. In the examples here, we assume the use of
sqlite for simplicity. However, in principle any platform supported by
the <code>DatabaseConnector</code> and <code>SqlRender</code> packages
should work.</p>
</div>
<div class="section level2">
<h2 id="creating-a-schema-definition-file">Creating a schema definition file<a class="anchor" aria-label="anchor" href="#creating-a-schema-definition-file"></a>
</h2>
<p>It is recommended that every analytics package that creates data
output should contain a csv file. This is a requirement for packages
that use the OHDSI <code>Strategus</code> library.</p>
<p>Schema definitions should conform to the following column
headers:</p>
<pre><code>table_name, column_name, data_type, is_required, primary_key</code></pre>
<p>In addition, other packages may make use of additional fields such as
<code>optional</code> or <code>empty_is_na</code>. These are not
required for uploading to a schem.</p>
<p>An example csv file may look like this:</p>
<pre><code># File inst/settings/resulsDataModelSpecifications.csv
table_name,column_name,data_type,is_required,primary_key
table_1,database_id,varchar,Yes,Yes
table_1,analysis_id,bigint,Yes,Yes
table_1,analysis_name,varchar,Yes,No
table_1,domain_id,varchar(20),No,No
table_1,start_day,float,No,No
table_1,end_day,float,No,No
table_1,is_binary,varchar(1),Yes,No
table_1,missing_means_zero,varchar(1),No,No
table_2,database_id,varchar,Yes,Yes
table_2,analysis2_id,bigint,Yes,Yes
table_2,concept_id,int,Yes,No
table_2,logic_description,varchar,No,No
table_2,valid_start_date,Date,Yes,No
table_2,concept_name,varchar(255),Yes,No
table_2,p_10_value,float,Yes,No
table_3,database_id,varchar,Yes,Yes
table_3,analysis3_id,bigint,Yes,Yes
table_3,concept_id,int,Yes,No
table_3,logic_description,varchar,No,No
table_3,valid_start_date,Date,Yes,No
table_3,concept_name,varchar(255),Yes,No
table_3,p_10_value,float,Yes,No</code></pre>
<p>Note the use of sql server data types in the <code>data_type</code>
field as well as <code>yes</code> and <code>no</code> in the binary
field <code>is_required</code> and <code>primary_key</code>.</p>
<p>We should also define a function for loading this file that converts
the column headers to camel case format.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Get Results Data Model Specifcations</span></span>
<span><span class="va">getResultsDataModelSpec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># For loading inside an R package</span></span>
<span>  <span class="va">specPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"settings"</span>, <span class="st">"resulsDataModelSpecifications.csv"</span>, package <span class="op">=</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageName.html" class="external-link">packageName</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">specPath</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SqlRender</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/SqlRender/reference/snakeCaseToCamelCase.html" class="external-link">snakeCaseToCamelCase</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-schema">Creating a schema<a class="anchor" aria-label="anchor" href="#creating-a-schema"></a>
</h2>
<p>This section describes how to use <code>RMM</code> to create a schema
from a specifications file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span><span class="st">"sqlite"</span>, server <span class="op">=</span> <span class="st">"MySqliteDb.sqlite"</span><span class="op">)</span></span>
<span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="fu">ResultModelManager</span><span class="fu">::</span><span class="fu"><a href="../reference/generateSqlSchema.html">generateSqlSchema</a></span><span class="op">(</span>schemaDefinition <span class="op">=</span> <span class="fu">getResultsDataModelSpec</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateExecuteSql.html" class="external-link">renderTranslateExecuteSql</a></span><span class="op">(</span><span class="va">connection</span>, <span class="va">sql</span>, database_schema <span class="op">=</span> <span class="st">"main"</span>, table_prefix <span class="op">=</span> <span class="st">"pre_"</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/disconnect.html" class="external-link">disconnect</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span></code></pre></div>
<p>Note that the SQL generated by <code>generateSqlSchema</code>
contains the required parameter <code>database_schema</code> and the
optional parameter <code>table_prefix</code>.</p>
</div>
<div class="section level2">
<h2 id="uploading-results">Uploading results<a class="anchor" aria-label="anchor" href="#uploading-results"></a>
</h2>
<p>This section shows how to upload results conforming to the above
specified schema. It is assumed that a zip file has been created with
csv files corresponding to the table names provided in the
<code>resulsDataModelSpecifications.csv</code> file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ResultModelManager</span><span class="fu">::</span><span class="fu"><a href="../reference/unzipResults.html">unzipResults</a></span><span class="op">(</span>zipFile <span class="op">=</span> <span class="st">"MyResultsZip.zip"</span>, resultsFolder <span class="op">=</span> <span class="st">"extraction_folder"</span><span class="op">)</span></span>
<span><span class="fu">ResultModelManager</span><span class="fu">::</span><span class="fu"><a href="../reference/uploadResults.html">uploadResults</a></span><span class="op">(</span><span class="va">connectionDetails</span>,</span>
<span>  schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  resultsFolder <span class="op">=</span> <span class="st">"extraction_folder"</span>,</span>
<span>  tablePrefix <span class="op">=</span> <span class="st">"pre_"</span>,</span>
<span>  purgeSiteDataBeforeUploading <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  specifications <span class="op">=</span> <span class="fu">getResultsDataModelSpec</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This will extract the zip file and upload results using
<code>DatabaseConnector</code>. For most platforms some form of bulk
loading is supported, the setup for this is contained in the
documentation for <code>DatabaseConnector</code>, it is strongly advised
that you set up and use this functionality for any platforms where you
will store large data sets. However, this is not necessary for the
sqlite example demonstrated here.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jamie Gilbert.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
